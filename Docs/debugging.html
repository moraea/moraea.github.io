<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Debugging Tips | Non-Metal Wiki</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Non-Metal Patches Wiki">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.7fad836b.css" as="style"><link rel="preload" href="/assets/js/app.2b808c84.js" as="script"><link rel="preload" href="/assets/js/2.208194ba.js" as="script"><link rel="preload" href="/assets/js/13.078dc5a1.js" as="script"><link rel="prefetch" href="/assets/js/10.3a8ff6f0.js"><link rel="prefetch" href="/assets/js/11.6e84a53c.js"><link rel="prefetch" href="/assets/js/12.4d7093b9.js"><link rel="prefetch" href="/assets/js/14.9b7bc023.js"><link rel="prefetch" href="/assets/js/15.5e414adb.js"><link rel="prefetch" href="/assets/js/16.d46e5495.js"><link rel="prefetch" href="/assets/js/17.f75ed2cb.js"><link rel="prefetch" href="/assets/js/18.9026007c.js"><link rel="prefetch" href="/assets/js/19.36083075.js"><link rel="prefetch" href="/assets/js/20.51c4d69f.js"><link rel="prefetch" href="/assets/js/21.ead2710c.js"><link rel="prefetch" href="/assets/js/3.8ec9049c.js"><link rel="prefetch" href="/assets/js/4.181ff618.js"><link rel="prefetch" href="/assets/js/5.8f741b70.js"><link rel="prefetch" href="/assets/js/6.6fe744f4.js"><link rel="prefetch" href="/assets/js/7.582a22f0.js"><link rel="prefetch" href="/assets/js/8.7ddaeb19.js"><link rel="prefetch" href="/assets/js/9.f79ee4b3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7fad836b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Non-Metal Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="/Tools/" class="nav-link">
  Tools
</a></div><div class="nav-item"><a href="https://github.com/moraea" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moraea
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Docs/" class="nav-link router-link-active">
  Documentation
</a></div><div class="nav-item"><a href="/Tools/" class="nav-link">
  Tools
</a></div><div class="nav-item"><a href="https://github.com/moraea" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moraea
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Documentation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docs/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/Docs/todo.html" class="sidebar-link">To Do</a></li><li><a href="/Docs/defaults.html" class="sidebar-link">Defaults Commands</a></li><li><a href="/Docs/debugging.html" aria-current="page" class="active sidebar-link">Debugging Tips</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docs/debugging.html#assembly-resources" class="sidebar-link">Assembly Resources</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#tools" class="sidebar-link">Tools</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#hopper-tips" class="sidebar-link">Hopper Tips</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#calling-convention-just-a-summary-see-cheatsheets" class="sidebar-link">Calling Convention (just a summary, see cheatsheets)</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#nop-something" class="sidebar-link">NOP Something</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#patch-something" class="sidebar-link">Patch Something</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#dyld-cache" class="sidebar-link">DYLD Cache</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#objc-ivars" class="sidebar-link">OBJC iVars</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#misc-macos-resources" class="sidebar-link">Misc. macOS Resources</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#lldb-tips" class="sidebar-link">LLDB Tips</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#objc-swizzling" class="sidebar-link">ObjC Swizzling</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#dyld-interposing" class="sidebar-link">DYLD Interposing</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#console-log-dmesg" class="sidebar-link">Console/log/dmesg</a></li><li class="sidebar-sub-header"><a href="/Docs/debugging.html#sample" class="sidebar-link">sample</a></li></ul></li><li><a href="/Docs/patchset.html" class="sidebar-link">Monterey Graphics Patch Sets</a></li><li><a href="/Docs/credits.html" class="sidebar-link">Credits</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="debugging-tips"><a href="#debugging-tips" class="header-anchor">#</a> Debugging Tips</h1> <p>WIP, intended as a list of resources and strategies that are useful when developing non-Metal fixes. Basically the non-metal class you guys always bother me about. Aiming to make this beginner-level without being condescending, please provide feedback...</p> <p>TODO: bug Slav, Flag, and everyone else who actually knows stuff!</p> <h2 id="assembly-resources"><a href="#assembly-resources" class="header-anchor">#</a> Assembly Resources</h2> <ul><li><a href="https://cs.brown.edu/courses/cs033/docs/guides/x64_cheatsheet.pdf" target="_blank" rel="noopener noreferrer">cheatsheet 1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/cirosantilli/x86-assembly-cheat" target="_blank" rel="noopener noreferrer">cheatsheet 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>TODO: there are a lot more</p> <h2 id="tools"><a href="#tools" class="header-anchor">#</a> Tools</h2> <ul><li><a href="https://hopperapp.com" target="_blank" rel="noopener noreferrer">Hopper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (easiest, best for objc, 30min demo, no cracks for recent version)</li> <li><a href="https://hex-rays.com/ida-free/" target="_blank" rel="noopener noreferrer">IDA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (best pseudocode, limited free version, cracks available)</li> <li><a href="https://ghidra-sre.org" target="_blank" rel="noopener noreferrer">Ghidra<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (scary)</li> <li><code>objdump</code> (built-in, great for scripting (e.g. find all uses of <code>PE_parse_boot_argn</code> in the system), pass <code>--x86-asm-syntax=intel</code> for familiar assembly syntax)</li> <li><code>otool</code> (similar to <code>objdump</code>, better at finding string refs and such, but only supports AT&amp;T syntax)</li> <li><a href="https://github.com/nygard/class-dump" target="_blank" rel="noopener noreferrer">class-dump<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>TODO: look into Jonathan Levin's stuff</li> <li><a href="https://github.com/Tyilo/insert_dylib" target="_blank" rel="noopener noreferrer">Insert_dylib<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>TODO: more</p> <h2 id="hopper-tips"><a href="#hopper-tips" class="header-anchor">#</a> Hopper Tips</h2> <ul><li>press <code>X</code> on a function/string for references</li> <li><code>D</code> cycles through 1/2/4/8-byte chunks, various (see Modify) to set data type</li> <li><code>C</code> sets as code, <code>P</code> creates procedure (needed for pseudocode)</li> <li>use the Edit menu to copy hex bytes (for some reason cmd+C doesn't work)</li></ul> <p>TODO: more tips?
TODO: hopper scripts/extensions?
TODO: IDA and stuff</p> <h2 id="calling-convention-just-a-summary-see-cheatsheets"><a href="#calling-convention-just-a-summary-see-cheatsheets" class="header-anchor">#</a> Calling Convention (just a summary, see cheatsheets)</h2> <p>Function calls use a standard register order, normally:
<code>rdi</code>, <code>rsi</code>, <code>rdx</code>, <code>rcx</code>, <code>r8</code>, <code>r9</code></p> <p>Or the shorter versions:
<code>edi</code>, <code>esi</code>, <code>edx</code>, <code>ecx</code>, <code>r8d</code>, <code>r9d</code></p> <p>Float/double values are passed in <code>xmm&lt;number&gt;</code> registers. Note that this means it often <em>doesn't actually matter</em> the order of float values relative to int/pointer ones. <code>f(int a,float b)</code> and <code>f(float a,int b)</code> will both use <code>edi</code> and <code>xmm0</code>.</p> <p>Structs (a common example being <code>CGRect</code>) get put onto the stack, as do ints/pointers that don't fit into the registers. This can be pretty confusing.</p> <p>Pointers and pointer types like <code>id</code> or <code>CF...Ref</code> are going to <em>always</em> be 64-bit (<code>r...</code>) registers. Long integers too. Shorter integers (and booleans) will use 32-bit (<code>e...</code>, <code>...d</code>). This can be helpful for guessing types. When writing a shim function, it's usually safe to use <code>long</code> or <code>void*</code> for a 64-bit register no matter the value.</p> <p>Return values will be in <code>rax</code> unless they're structs (stack), floats (<code>xmm0</code>) or some weird thing that returns two values (TODO).</p> <p>Keep in mind that C programming also uses a lot of &quot;output parameters&quot;, i.e. pointers to a caller-created output variable, passed in as an argument, which the function will dereference and write to.</p> <p>It's usually easier to figure out a function signature by finding somewhere it's called, rather than its actual implementation. Keep in mind that disassembler pseudocode will often tack on extra arguments (e.g. if something set <code>rdx</code> a couple lines above, it might think it's the third argument to a 2-argument function), and it will often completely miss floats and stack arguments. If something messes with the stack or sets <code>xmm0</code> just before a function call, be careful...</p> <p>In C++ functions, <code>this</code> is passed in <code>rdi</code> so the arguments you see in the source code start at <code>rsi</code>.</p> <p>In objc functions, <code>self</code> and the selector are passed in <code>rdi</code> and <code>rsi</code>. However objc signatures can usually be found with type encodings or class-dump anyways (TODO).</p> <p>TODO: would it be helpful to have a sample walkthrough of finding the signature of some random SL function here?</p> <h2 id="nop-something"><a href="#nop-something" class="header-anchor">#</a> NOP Something</h2> <p>Find the offending assembly and check the hex view or addresses to figure out the file offset and how many bytes to kill (instructions are variable size, so a line of assembly will be multiple <code>nop</code>s). Then use a hex editor or <code>Binpatcher</code> or whatever to overwrite that range with <code>0x90</code>. Alternately, assemble a jump instruction (alt+A and <code>jmp &lt;offset&gt;</code>) to skip a big chunk of code.</p> <p>TODO: screenshots if this is confusing</p> <h2 id="patch-something"><a href="#patch-something" class="header-anchor">#</a> Patch Something</h2> <p>Similarly to <code>nop</code>, but use alt+A to overwrite with lines of assembly and overwrite those corresponding hex bytes instead of <code>0x90</code>. Have to be clever about instruction sizes -- differing sizes will trash (multiple) subsequent lines, make sure to clean up with <code>nop</code>s or use the same size. (Operating on smaller parts of the register (e.g. <code>al</code>/<code>eax</code> for <code>rax</code>) is usually shorter.)</p> <p>To force a function to return a certain value, use <code>mov rax,&lt;stuff&gt;</code> followed by <code>ret</code>. If not at the top of the function, you have to worry about stack stuff (TODO).</p> <p>TODO: more screenshots</p> <h2 id="dyld-cache"><a href="#dyld-cache" class="header-anchor">#</a> DYLD Cache</h2> <ul><li>check the ramdisk for uncached binaries! (low-ish level, not AppKit or anything sadly)</li> <li><a href="https://twitter.com/zhuowei/status/1402137181502722051" target="_blank" rel="noopener noreferrer">Apple's extractor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (this will give very broken binaries, but it's great for dumping them all to a folder so you can <code>grep</code> for mystery error strings)</li> <li>Hopper and IDA can both load semi-broken binaries</li> <li>Catalina can be helpful as a last resort</li> <li>TODO: correlating symbols from lldb/backtrace with sub_... crap in disassemblers</li> <li>no known (to me) way to get out <em>working</em> binaries, please prove me wrong...</li></ul> <p>TODO: research more tools, Flag sent some?</p> <h2 id="objc-ivars"><a href="#objc-ivars" class="header-anchor">#</a> OBJC iVars</h2> <p>Sometimes (in Hopper, IDA doesn't seem to handle this) you will see named ivar structures with a small numeric value being added to an id reference. This is the internal implementation of @property.</p> <p>TODO: definitely needs some screenshots. should also just cover the &quot;struct pointer + offset&quot; concept in general.</p> <h2 id="misc-macos-resources"><a href="#misc-macos-resources" class="header-anchor">#</a> Misc. macOS Resources</h2> <ul><li><a href="https://osstatus.com" target="_blank" rel="noopener noreferrer">OSStatus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (look up macOS error codes)</li> <li><a href="http://fuckingblocksyntax.com" target="_blank" rel="noopener noreferrer">fuckingblocksyntax.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Jonathan Levin's books (extremely detailed, PDFs on libgen)</li> <li><a href="https://cdn.discordapp.com/attachments/750933997927792650/860813736116617246/the_textbook.zip" target="_blank" rel="noopener noreferrer">COMP2401 Memory Management PDF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>TODO: that kernel programming book Flag sent</li></ul> <p>TODO: there are so many more</p> <h2 id="lldb-tips"><a href="#lldb-tips" class="header-anchor">#</a> LLDB Tips</h2> <ul><li>run <code>attach -w -n &lt;process name&gt;</code> <em>before</em> launching the victim process and it will attach and pause when it barely started at all</li> <li><code>b &lt;function/selector name/address&gt;</code> to set a breakpoint</li> <li><code>b -r '&lt;regex&gt;'</code> for setting multiple breakpoints at once, can be very powerful e.g. <code>b -r '.*NSWindow.*' -C bt -G true</code> to log all NSWindow calls without stopping</li> <li><code>d</code> to print assembly of current function, <code>n</code> to step without going into calls, <code>s</code> to step going into calls, <code>c</code> to resume</li> <li><code>settings set target.x86-disassembly-flavor intel</code> for familiar assembly syntax (can put in <code>~/.lldbinit</code>)</li></ul> <p>TODO: example?</p> <h2 id="objc-swizzling"><a href="#objc-swizzling" class="header-anchor">#</a> ObjC Swizzling</h2> <ul><li>see <code>Utils/Swizzle.m</code> in the Monterey repo for how to swizzle using an IMP (C-style function) and <a href="https://github.com/moraea/slplugins/blob/main/DiskReveal/DiskReveal.m" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for an example implementation.</li> <li><a href="https://nshipster.com/method-swizzling/" target="_blank" rel="noopener noreferrer">alternate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (and worse, IMO) approach</li></ul> <h2 id="dyld-interposing"><a href="#dyld-interposing" class="header-anchor">#</a> DYLD Interposing</h2> <ul><li>pretty straightforward but you have to paste in that weird macro, TODO</li></ul> <p>Note that swizzling/interposing is not only good for &quot;fixing&quot; stuff, but also for dynamic analysis -- logging and experimenting with changing values. I do this a lot.</p> <p>TODO: <code>DYLD_INSERT_LIBRARIES</code> (including launchctl and __XPC use, AMFI problems etc)</p> <h2 id="console-log-dmesg"><a href="#console-log-dmesg" class="header-anchor">#</a> Console/<code>log</code>/<code>dmesg</code></h2> <p>Not to be underestimated. Make sure to enable debug/info messages. <code>log show -last boot -debug -info --predicate 'message contains &quot;some shit&quot;'</code> is very useful.</p> <h2 id="sample"><a href="#sample" class="header-anchor">#</a> <code>sample</code></h2> <p>Either run on the command-line or through Activity Monitor, this lists a graph of functions being called in a process. Really great for finding places to start looking in a disassembler and/or seeing if a process is actually doing anything.</p> <p>TODO: lsof/fs_usage</p> <p>TODO: so much more to put here...</p> <p>TODO: would a complete sample workflow of creating a shim function (something simple like the dock ones or accessibility zoom) be useful?</p> <p>TODO: learn about mach_msg/MIG and document it here (currently all i really know is SLS... corresponding to _X... which is SL specific). similarly, IOConnect... calls. and other XPC stuff</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Docs/defaults.html" class="prev">
        Defaults Commands
      </a></span> <span class="next"><a href="/Docs/patchset.html">
        Monterey Graphics Patch Sets
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2b808c84.js" defer></script><script src="/assets/js/2.208194ba.js" defer></script><script src="/assets/js/13.078dc5a1.js" defer></script>
  </body>
</html>
